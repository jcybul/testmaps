<!DOCTYPE html>
<meta charset="utf-8">
<style>
  /* Region colors? */
  .subunit.SCT {
    fill: #ddc;
  }

  .subunit.WLS {
    fill: #cdd;
  }

  .subunit.NIR {
    fill: #cdc;
  }

  .subunit.ENG {
    fill: #dcd;
  }


  .subunit.IRL,
  .subunit-label.IRL {
    display: none;
  }

  .subunit-boundary {
    fill: none;
    stroke: #777;
    stroke-dasharray: 2, 2;
    stroke-linejoin: round;
  }

  .subunit-boundary.IRL {
    stroke: #aaa;
  }

  .subunit-label {
    fill: #777;
    fill-opacity: .5;
    font-size: 20px;
    font-weight: 300;
    text-anchor: middle;
  }

  .place,
  .place-label {
    fill: #444;
  }

  text {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 10px;
    pointer-events: none;
  }

  .right_box {
    position: absolute;
    right: 20px;
    top: 20px;
    width: 30%;
    height: 90%;
  }

  .details {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  
  body {
    margin: 0;
  }
</style>

<body>
  Simple UK
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
  <script>

    function generateRandom(min = 0, max = 100) {
      return min + Math.floor(Math.random() * (max - min));
    }


    const width = window.innerWidth * 2 / 3;
    const height = window.innerHeight;

    let projection = d3.geo.albers()
      .center([0, 55.4])
      .rotate([4.4, 0])
      .parallels([50, 60])
      .scale(1200 * 5)
      .translate([width / 2, height / 2]);

    let path = d3.geo.path()
      .projection(projection)
      .pointRadius(2);

    // let svg = d3.select("body").append("svg")
    // .attr("width", width)
    // .attr("height", height)
    let svg = d3.select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .call(d3.behavior.zoom().on("zoom", function () {
        svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
      }))
      .append("g");

    function componentToHex(c) {
      var hex = c.toString(16);
      return hex.length == 1 ? "0" + hex : hex;
    }

    function rgbToHex(R) {
      l = R.Color.match(/\d+/g).map(Number)
      console.log(l[0])
      return "#" + componentToHex(l[0]) + componentToHex(l[1]) + componentToHex(l[2]);
    }


    function renderMap(maps, callback) {
      const currentMap = maps.pop();
      const colors = ["#AFE1AF", "#7DF9FF", "#90EE90", "#ECFFDC"];
      const mapName = currentMap.split(".")[0];

      d3.json(currentMap, function (error, data) {
        const subunits = topojson.feature(data, data.objects.lad || data.objects.lgd);
        console.log("Rendering " + currentMap);

        d3.json('joint.json', function (error2, m) {
          if (error2) return console.error(error2);
          console.log(m["E06000001"].Color)

          svg.selectAll(".subunit_" + mapName)
            .data(subunits.features)
            .enter().append("path")
            .attr('id', (d) => d.id)
            .attr("class", (d) => "subunit " + d.id)
            .attr("fill", function (d) {
              try { return rgbToHex(m[d.id]) }
              catch { return "white" }
            })
            .attr("d", path)
            .on("click", function (d, i) {
              document.getElementById("region_name").innerHTML = `Region ID: ${d.id}`;
              document.getElementById("region_pop").innerHTML = `Population: ${m[d.id]["Population"]}`;
              document.getElementById("region_income").innerHTML = `Income: ${m[d.id]["Income"]}`;
            });


          if (maps.length === 0) {
            callback();
          } else {
            renderMap(maps, callback);
          }
        });
      })
    }

    renderMap(["data.json", "ni.json", "scotland.json", "wales.json"], function () {
      let michelin;
      d3.csv('michellinData.csv', function (error2, m) {
        if (error2) return console.error(error2);
        console.log(m)

        svg.selectAll("circles.points")
          .data(m)
          .enter()
          .append("circle")
          .attr("fill", "black")
          .attr("r", function (d) { return 0.01* d.rating })
          .attr("transform", function (d) { return "translate(" + projection([d.lng, d.lat]) + ")"})
      })
    });

  </script>


<div class="right_box">
  <div class="details">
    <h>Simple UK</h>
    <p id="region_name">Region ID: {click to map select}</p>
    <p id="region_pop">Population: {click to map select}</p>
    <p id="region_income">Income: {click to map select}</p>
  </div>
</div>
  

</body>